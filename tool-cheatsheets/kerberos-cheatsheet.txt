Overview
    3 Roles
        Client (hostname and user)
        Server/Service ("SPN")
        DC ("KDC")
            Also usually a DNS server, authentication server, ticket granting server

    3 Long-Term Secrets
        krbtgt password
            on DC
            signs tgt's and st's
            authoritative copies of all domain user pw hashes

        client pw hash

        SPN account's password
            SPN's can be a property of a user or computer

    3 steps to authenticate
        Pre-auth (obtain Ticket-Granting Ticket)
            Tends to happen at windows login
            TGT's are valid for 5 min by default

            AS-REQ
                Client req to DC, pw-hash and time

            AS-REP
                KDC returns TGT and session key

        Request service ticket
            TGS-REQ
                Client sends DC request with SPN and TGT

            TGS-REP
                DC responds with svc ticket

        Use svc ticket
            ST
                Client sends svc ticket to server 

Formats
    SPN
        serviceClass/host:port

    Hostname vs FQDN
        hostname.domainname.xyz

Terms
    Golden Ticket
    Silver Ticket

Attacks:
    Kerberoast:
        Query DC for user accts with SPN's
        Req svc tickets for those SPN's
        Offline password cracking against those tickets
        Results in username and NThash extraction 

    Pass-the-ticket
        Steal ticket from compromised machine using mimikatz, rubeus
        Reuse ticket on other box to access service
    
    Overpass-the-hash
        With the user's hash, generate a TGT

    Skeleton Key
        Adds second password to all accounts
        Function override on DC
        Volatile on DC w/ debug privileges from mimikatz

    Golden Ticket
        Forging TGTs using krbtgt hash
        impacket, mimikatz, rubeus, most c2's
        requires krbtgt hash, domain SID, FQDN

    Silver Ticket
        Forged ST's
        requires the service's hash
        Can grant a user additional group perms (for that svc)
        On a DC, can escalate to the krbtgt hash with DCSync

    DCSync/DCShadow
        Replicates the domain

    Access ntds.dit
        ntdsutil.exe -> ifm snapshot
        secretsdump.py
        volume shadow copy service
    